<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Una | Live Stream</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css">
<style>
  :root {
    --bg-dark: #0e0e10;
    --panel-dark: #18181b;
    --accent: #9147ff;
    --accent-hover: #772ce8;
    --text-main: #efeff1;
    --text-muted: #adadb8;
    --error: #eb0400;
    --success: #00f593;
  }

  * { box-sizing: border-box; }
  body { 
    margin: 0; 
    font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif; 
    background: var(--bg-dark); 
    color: var(--text-main);
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* Header / Nav */
  header {
    height: 50px;
    background: var(--panel-dark);
    display: flex;
    align-items: center;
    padding: 0 20px;
    border-bottom: 1px solid #26262c;
    justify-content: space-between;
  }

  .logo { font-weight: 800; color: var(--accent); letter-spacing: -1px; font-size: 1.2rem; }

  #main { 
    flex: 1; 
    display: flex; 
    overflow: hidden; 
  }

  /* Terminal Area */
  #viewport {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 20px;
    background: #050505;
    position: relative;
  }

  #term-wrapper {
    flex: 1;
    background: #000;
    border-radius: 4px;
    padding: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    border: 1px solid #1f1f23;
  }

  /* Sidebar (Chat & Stats) */
  #sidebar {
    width: 340px;
    background: var(--panel-dark);
    border-left: 1px solid #26262c;
    display: flex;
    flex-direction: column;
  }

  .sidebar-header {
    padding: 15px;
    text-transform: uppercase;
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--text-muted);
    border-bottom: 1px solid #26262c;
  }

  #chat-feed {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    font-size: 0.85rem;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .chat-msg { line-height: 1.4; }
  .chat-user { font-weight: 700; color: var(--accent); }

  .status-area {
    padding: 20px;
    background: #1f1f23;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--text-muted);
  }

  .live .indicator { background: var(--success); box-shadow: 0 0 8px var(--success); }
  .offline .indicator { background: var(--error); }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 5px; }
  ::-webkit-scrollbar-thumb { background: #333; }
</style>
</head>
<body class="offline" id="body-state">

<header>
  <div class="logo">UNA_</div>
  <div id="live-label" style="font-size: 0.7rem; background: var(--error); padding: 2px 6px; border-radius: 4px; font-weight: bold; display:none;">LIVE</div>
</header>

<div id="main">
  <div id="viewport">
    <div id="term-wrapper">
      <div id="term" style="height: 100%;"></div>
    </div>
    
    <div style="margin-top: 15px;">
      <h1 style="margin:0; font-size: 1.2rem;">Terminal Session Live by Una</h1>
      <p style="color:var(--text-muted); font-size: 0.9rem;">Real time terminal streaming platform</p>
    </div>
  </div>

  <aside id="sidebar">
    <div class="sidebar-header">Stream Chat(Placeholder to be implemented)</div>
    <div id="chat-feed">
      <div class="chat-msg"><span class="chat-user">System:</span> Waiting for host connection...</div>
    </div>
    
    <div class="status-area">
      <div class="indicator"></div>
      <div>
        <div id="status-text" style="font-weight: bold; font-size: 0.9rem;">OFFLINE</div>
        <div style="font-size: 0.75rem; color: var(--text-muted);">Auto-reconnecting...</div>
      </div>
    </div>
  </aside>
</div>

<script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit/lib/xterm-addon-fit.js"></script>

<script>
const term = new Terminal({
  cursorBlink: true,
  fontSize: 14,
  fontFamily: '"Fira Code", monospace',
  theme: {
    background: '#000000',
    foreground: '#efeff1',
    cursor: '#9147ff',
    selection: 'rgba(145, 71, 255, 0.3)'
  }
});

const fitAddon = new FitAddon.FitAddon();
term.loadAddon(fitAddon);
term.open(document.getElementById('term'));
fitAddon.fit();

const body = document.getElementById("body-state");
const statusText = document.getElementById("status-text");
const liveLabel = document.getElementById("live-label");
const chatFeed = document.getElementById("chat-feed");

function addChat(msg) {
  const div = document.createElement('div');
  div.className = 'chat-msg';
  div.innerHTML = `<span class="chat-user">System:</span> ${msg}`;
  chatFeed.appendChild(div);
  chatFeed.scrollTop = chatFeed.scrollHeight;
}

let ws;
function connectWS() {
  ws = new WebSocket("ws://localhost:8080/ws");
  ws.binaryType = "arraybuffer";

  ws.onopen = () => {
    body.className = "live";
    statusText.textContent = "LIVE";
    liveLabel.style.display = "block";
    addChat("Connected to terminal instance.");
  };

  ws.onclose = () => {
    body.className = "offline";
    statusText.textContent = "OFFLINE";
    liveLabel.style.display = "none";
    addChat("Connection lost. Retrying...");
    setTimeout(connectWS, 2000);
  };

  ws.onmessage = e => {
    try {
      const data = JSON.parse(e.data);
      if (data.type === "output") term.write(data.data);
    } catch(err) {
      // If raw data is sent instead of JSON
      term.write(e.data);
    }
  };
}

connectWS();
window.addEventListener('resize', () => fitAddon.fit());
</script>
</body>
</html>
